#!/usr/bin/env cbqn
# summarize a CSV file generated by `benchm`
# Usage: parse.bqn generated.csv
csv â† {
  # Control characters: double quote, comma, newline
  control â† ""","âˆ¾@+10
  # Join by separator ğ•¨
  J â† âˆ¾1â†“Â·â¥Š<âŠ¸(â‰Ë˜)
  # CSV text to list of list of strings
  Split â† { ğ•Šâ¼ğ•©: Joinğ•© ;
   [q,c,n] â† control=âŒœğ•©
   e â† â‰ `q       # Escaped characters
   s â† e<câˆ¨n     # Split points
   d â† sâˆ¨q>Â»e<q  # Characters to be dropped
   (0âˆ¾s/+`e<n) âŠ” (d(Â¬âŠ¸Ã—-âŠ£)+`s) âŠ” ğ•©
  }
  # Parse list of lines, e.g. from â€¢file.Lines
  SplitL â† { ğ•Šâ¼ğ•©: JoinLğ•© ; Split (2âŠ‘control) J ğ•© }
  # List of list of strings, or table, to list of lines
  # Result contains internal line separators if ğ•© does
  JoinL â† { ğ•Šâ¼ğ•©: SplitLğ•© ;
    qâ€¿câ€¿n â† control
    ğ•© <Ë˜âŸ(1<=)â†©
    Esc â† (qâˆ¾Ëœqâˆ¾(1+qâŠ¸=)âŠ¸/)âŸ(âˆ¨Â´controlâŠ¸âˆŠ)
    (c J EscÂ¨)Â¨ ğ•©
  }
  # To CSV text
  Join â† { ğ•Šâ¼ğ•©: Splitğ•© ; (2âŠ‘control) J JoinL ğ•© }
  NoValueField â† (âŸ¨1,1âŸ©âŠ¸â‰¡)Â¨âˆ˜<Ë˜2â†•Â·(','âŠ¸â‰¡)Â¨(','âŠ¸(âˆ¾Ëœ))
  RelativePath â† { '/'=âŠ‘ğ•© ? ğ•©; â€¢wdpathâˆ¾ "/"âˆ¾ ğ•© }
  ParseFile â‡ {
  ((@âŠ¸â‰ )Â¨âŠ¸/)Â¨Â¨Ë˜Â·SplitL (âˆ¾NoValueFieldâŠ¸({ğ•¨ ? âŸ¨',',@âŸ©;âŸ¨ğ•©âŸ©}Â¨))Â¨ ('#'âŠ¸â‰¢âŠ‘)Â¨âŠ¸/â€¢Flines RelativePath ğ•©;
  ((@âŠ¸â‰¢)Â¨âŠ¸/)Â¨Â¨Ë˜Â·SplitL (âˆ¾NoValueFieldâŠ¸({ğ•¨ ? âŸ¨',',@âŸ©;âŸ¨ğ•©âŸ©}Â¨))Â¨ ğ•¨â†“('#'âŠ¸â‰¢âŠ‘)Â¨âŠ¸/â€¢Flines RelativePath ğ•©
  }
}
color â† {
  esc â‡ @ + 27
  csi â‡ escâˆ¾"["
  reset â‡ csiâˆ¾"0m"
  RGB â‡ {
      ğ•Š râ€¿gâ€¿b: escâˆ¾"[38;2;"âˆ¾(â€¢Fmt r)âˆ¾";"âˆ¾(â€¢Fmt g)âˆ¾";"âˆ¾(â€¢Fmt b)âˆ¾"m";
    0 ğ•Š râ€¿gâ€¿b: escâˆ¾"[38;2;"âˆ¾(â€¢Fmt r)âˆ¾";"âˆ¾(â€¢Fmt g)âˆ¾";"âˆ¾(â€¢Fmt b)âˆ¾"m";
    râ€¿gâ€¿b ğ•Š 0: escâˆ¾"[48;2;"âˆ¾(â€¢Fmt r)âˆ¾";"âˆ¾(â€¢Fmt g)âˆ¾";"âˆ¾(â€¢Fmt b)âˆ¾"m";
    bg ğ•Š fg: (bg ğ•Š 0)âˆ¾ğ•Š fg
  }
  Out â‡ { c ğ•Š t: câˆ¾tâˆ¾reset }
  Fmt â‡ { c ğ•Š t: câˆ¾(â€¢Fmt t)âˆ¾reset }
}

Colored â† {
 ğ•Š nâ€¿noâ€¿nameâ€¿timeâ€¿0: âŸ¨color.RGB 240â€¿20â€¿100âŸ©âˆ¾(Â¯1â†“ğ•©)âˆ¾âŸ¨color.resetâŸ©;
 ğ•Š nâ€¿noâ€¿nameâ€¿timeâ€¿1: âŸ¨color.RGB 20â€¿180â€¿120âŸ©âˆ¾(Â¯1â†“ğ•©)âˆ¾âŸ¨color.resetâŸ©
}
Replace â† {âŠ‘ğ•©âˆŠğ•¨ ? ' ';ğ•©}
Sat â† { ğ•Š "": âˆ;ğ•Š "false": 0; ğ•Š "true": 1}
solved â‡ (âˆâŠ¸â‰ 4âŠ¸âŠ‘)Ë˜âŠ¸/{âŸ¨â€¢BQN 3âŠ‘ğ•©,â€¢BQN 1âŠ‘ğ•©,66(<âŸœâ‰ )â—¶âŸ¨âŠ¢,â†‘âŸ©2âŠ‘ğ•©,â€¢ParseFloat 4âŠ‘ğ•©,Sat 6âŠ‘ğ•©âŸ©}Ë˜((â‰ â‹ˆ(â‰ âŠ‘))â¥Šâˆ¾Â´) 1 csv.ParseFile âŠ‘â€¢args
â€¢Out ("â”Œâ”€â•µâ”˜"""âŠ¸Replace)Â¨â€¢Fmt ColoredË˜ solved
